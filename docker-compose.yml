version: "3.8"

services:
  # 1. Web Application Firewall (WAF) / Reverse Proxy
  waf:
    build:
      context: .
      dockerfile: ./images/waf/Dockerfile
    # IMAGE TAG MUSS mit dmz_topology.yaml Ã¼bereinstimmen
    image: waf:latest
    container_name: build_waf

  # 2. Intrusion Detection System (IDS)
  ids:
    build:
      context: .
      dockerfile: ./images/ids/Dockerfile
    image: ids:latest
    container_name: build_ids

  # 3. SIEM System (Log Collector)
  siem:
    build:
      context: .
      dockerfile: ./images/siem/Dockerfile
    image: siem:latest
    container_name: build_siem

  # 4. Client/Attacker Base Image
  attacker:
    build:
      context: ./images/attacker
      dockerfile: Dockerfile
    image: attacker:latest
    container_name: build_attacker_base

  # 5. Webserver Base Image
  webserver:
    build:
      context: .
      dockerfile: ./images/webserver/Dockerfile
    image: webserver:latest
    container_name: build_webserver

  # 6. NEU: Firewall Base Image (Muss gebaut werden, um Bash/IP-Tools zu haben)
  firewall:
    build:
      context: .
      dockerfile: ./images/firewall/Dockerfile
    image: firewall:latest
    container_name: build_firewall

  # 7. Database Image
  db:
    build:
      context: .
      dockerfile: ./images/db/Dockerfile
    image: db:latest
    container_name: build_db

  # 8. SIEM Overlay
  siem-overlay:
    build:
      context: ./images/siem_overlay
      dockerfile: Dockerfile
    image: siem-overlay:latest
    container_name: build_siem_overlay

  # 9. Wazuh Manager
  wazuh-manager:
    build:
      context: ./images/wazuh_manager
      dockerfile: Dockerfile
    image: wazuh-manager:latest
    container_name: build_wazuh_manager

  # 10. Wazuh Indexer
  wazuh-indexer:
    build:
      context: ./images/wazuh_indexer
      dockerfile: Dockerfile
    image: wazuh-indexer:latest
    container_name: build_wazuh_indexer

  # 11. Wazuh Dashboard
  wazuh-dashboard:
    build:
      context: ./images/wazuh_dashboard
      dockerfile: Dockerfile
    image: wazuh-dashboard:latest
    container_name: build_wazuh_dashboard
