name: dmz-project-sun
topology:
  nodes:
    attacker-internet:
      kind: linux
      image: attacker:latest
    edge-firewall:
      kind: linux
      image: firewall:latest
    reverse-proxy-waf:
      kind: linux
      image: waf:latest
      memory: 512Mb
    internal-firewall:
      kind: linux
      image: firewall:latest
    webserver:
      kind: linux
      image: webserver:latest
    ids-dmz:
      kind: linux
      image: ids:latest
    siem-backend:
      kind: linux
      image: siem:latest
      binds:
        - ./logs/siem:/var/log/siem_logs:rw
    db-backend:
      kind: linux
      image: db:latest
    client-internal:
      kind: linux
      image: attacker:latest

    siem-overlay:
      kind: linux
      image: siem-overlay:latest
      binds:
        - ./logs/siem:/var/log/siem_logs:rw
        - ./dmz-project-sun.clab.yml:/app/topology.yml:ro
      ports:
        - 9098:5000

  links:
    # Internet -> Edge Firewall
    - endpoints: ["attacker-internet:eth1", "edge-firewall:eth1"]

    # Edge Firewall -> Internal Firewall
    - endpoints: ["edge-firewall:eth2", "internal-firewall:eth1"]

    # Edge Firewall -> IDS (Mirror Port)
    - endpoints: ["edge-firewall:eth3", "ids-dmz:eth1"]

    # Internal Firewall -> SIEM
    - endpoints: ["internal-firewall:eth2", "siem-backend:eth1"]

    # Internal Firewall -> Client
    - endpoints: ["internal-firewall:eth3", "client-internal:eth1"]

    # Internal Firewall -> WAF -> Webserver
    - endpoints: ["internal-firewall:eth4", "reverse-proxy-waf:eth1"]
    - endpoints: ["reverse-proxy-waf:eth2", "webserver:eth1"]

    # Internal Firewall -> IDS (Mirror Port)
    - endpoints: ["internal-firewall:eth5", "ids-dmz:eth2"]
